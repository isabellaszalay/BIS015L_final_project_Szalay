---
title: "How to Become a Billionaire"
output: html_document
date: "2023-02-21"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library("tidyverse")

library("janitor")

library("naniar")

library(RColorBrewer)

library(paletteer)
```

```{r}
getwd()
```

# Load Data, Tidy Names, & Identify NAs
```{r}
billionaires<- read.csv("forbes_dataset_2022/forbes_billionaires_2022.csv", na="")
billionaires
```

```{r}
billionaires <- janitor::clean_names(billionaires)
```

```{r}
naniar::miss_var_summary(billionaires)
```

```{r}
companies <- read.csv("forbes_dataset_2022/forbes_companies_2022.csv", na="")
companies
```

```{r}
companies <- janitor::clean_names(companies)
```

```{r}
naniar::miss_var_summary(companies)
```


# Separate B/M
```{r}
companies <- companies %>%
    separate(sales, into=c("sales", "factor1"), sep=" ")
```

```{r}
companies <- companies %>%
  separate(profit, into=c("profit", "factor2"), sep=" ")
```

```{r}
companies <- companies %>%
  separate(assets, into=c("assets", "factor3"), sep=" ")
```

```{r}
companies <- companies %>%
  separate(market_value, into=c("market_value", "factor4"), sep=" ")
```


# Get Rid of '$' & Turn Values into Numeric
```{r}
companies$sales = gsub("\\$", "", companies$sales)
companies$sales = as.numeric(companies$sales)
```

```{r}
companies$profit=as.numeric(gsub("\\$", "", companies$profit))
```

```{r}
companies$assets = gsub(",","", companies$assets)
companies$assets = gsub("\\$","", companies$assets)
companies$assets = as.numeric(companies$assets)
```

```{r}
companies$market_value = gsub(",","", companies$market_value)
companies$market_value = gsub("\\$","", companies$market_value)
companies$market_value = as.numeric(companies$market_value)
```


# Turn Millions into Billions
```{r}
companies <- companies %>%
  mutate(across(c(sales), ~ case_when(factor1 == "M"~ .x/1000,
                                      TRUE ~ .x)))
```

```{r}
companies <- companies %>%
  mutate(across(c(profit), ~ case_when(factor2 == "M"~ .x/1000,
                                      TRUE ~ .x)))
```

```{r}
companies <- companies %>%
  mutate(across(c(assets), ~ case_when(factor3 == "M"~ .x/1000,
                                      TRUE ~ .x)))
```

```{r}
companies <- companies %>%
  mutate(across(c(market_value), ~ case_when(factor4 == "M"~ .x/1000,
                                      TRUE ~ .x)))
```


# Removing the columns with the name factor

```{r}
companies <- companies %>% 
  select(-factor1, -factor2, -factor3, -factor4)
```


# Renaming the columns
```{r}
companies <- companies %>% 
  rename(sales_bil = "sales", profit_bil = "profit", assets_bil = "assets", market_value_bil = "market_value")
```

-----

- "about" isn't important for analyzing data

- "state" NAs refer to people outside the US

- "title" may not have a current working position especially if they are not involved in an organization

- "philanthropyScore" interesting metric but a lot of data is not available - we might still be able to do something with this or find additional data.

- "organization" some wealth is from family, or several different organizations, we still have field they work in and source of wealth so hopefully that is okay 


## things we may want to analyze for: 

filter country to US - look at which states produce the most billionaires

2 - *what country has the most assets/profits?

histogram: frequency of people born over span of years 

*connecting final worth of billionaires to the field they are in - can optimize to see which field produces the highest profit margins 

something with final worth and if they are self made or not 

DONE - 1 - mutate net profit margin = net profit/revenue * 100 - can be an indicator of the company's stability of income (shows whether a company is reliable or not) & assets to sales ratio = assets/sales - could make shiny app for this

DONE - comparison of highest to lowest market value - connect to the field 

plot - can filter for the top 10 companies that have the highest net profit margin and market value - a combination of both would indicate a very stable company, can make a bar plot to "show" the highest of both (like on the last question of the midterm)

we can then use the top 10 companies to see which country comes up the highest (likely the US) and then connect these to the billionaires data

------

```{r}
companies
```

```{r}
companies %>%
  select(global_company, profit_bil) %>%
  arrange(-profit_bil) %>%
  head(10)
```

```{r}
ui <- dashboardPage(
  dashboardHeader(title = "Profits by Company"),
  fluidRow(
  box(title = "Plot Options", width = 4,
  selectInput("x", "Select Company", choices = c("Saudi Arabian Oil Company (Saudi Aramco)", "Apple", "Berkshire Hathaway", "Alphabet", "Microsoft", "ICBC", "China Construction Bank", "JPMorgan Chase", "Meta Platforms", "Agricultural Bank of China"),
              selected = "Saudi Arabian Oil Company (Saudi Aramco)"),
 
  ),
  
server <- function(input, output, session) { 
  
  session$onSessionEnded(stopApp)
  
  output$plot <- renderPlot({
    companies %>% 
    filter(global_company==input$x) %>% 
    ggplot(aes(x=global_company, y=profit_bil)) + 
      geom_col(color="darkgoldenrod2", fill="coral1", alpha=0.9) +
      theme_linedraw(base_size = 18) +
      theme(axis.text.x = element_text(angle = 70, hjust = 1))
  })
  
  session$onSessionEnded(stopApp)

  }

shinyApp(ui, server)
```

## Mutating the profit/revenue column for net profit margin - is there a correlation between profit margins and market value?
```{r}
companies_NPM <- companies %>% 
  mutate(net_profit_margin_percent = profit_bil/sales_bil *100) %>% 
  filter(global_company != "Bradespar") %>% 
  arrange(-net_profit_margin_percent) %>% 
  head(10)
companies_NPM
```

## Mutating the assets to sales ratio
```{r}
companies %>% 
  mutate(assets_sales_ratio = assets_bil/sales_bil) %>% 
  filter(global_company != "Bradespar") %>% 
  arrange(-assets_sales_ratio) %>% 
  head(10)
```

## Comparison of highest market value to lowest market value

Highest market value - top 10
```{r}
companies_MV_high <- companies %>% 
  arrange(-market_value_bil) %>% 
  head(10) %>% 
  select(global_company, country, market_value_bil) %>% 
  ggplot(aes(x=reorder(global_company, market_value_bil), y=market_value_bil, fill = country))+
  geom_col(color = "black")+
  coord_flip()+
  labs(title = " Highest Market Values of the Top 10 Global Companies by Country",
       x = "Market Value",
       y = "Global Company")
```

```{r}
companies_MV_high+
  theme_light()+
  theme(plot.title = element_text(size = 10, face = "bold"),
        axis.title = element_text(size=10),
        axis.text.x = element_text(size=9, hjust=1))
```

Lowest Market Value - Lower 10
```{r}
companies_MV_low <- companies %>% 
  arrange(market_value_bil) %>% 
  head(10) %>% 
  select(global_company, country, market_value_bil) %>% 
  ggplot(aes(x=reorder(global_company, market_value_bil), y=market_value_bil, fill = country))+
  geom_col(color = "black")+
  coord_flip()+
  labs(title = "Lowest Market Values of the Top 10 Global Companies by Country",
       x = "Market Value",
       y = "Global Company")
```

```{r}
companies_MV_low+
  theme_light()+
  theme(plot.title = element_text(size = 10, face = "bold"),
        axis.title = element_text(size=10),
        axis.text.x = element_text(size=9, hjust=1))
```

## Trying to find the companies with the best market value and net profit margins - ask during OH
```{r}
companies_1 <- companies %>% 
  mutate(net_profit_margin_percent = profit_bil/sales_bil *100) %>% 
  filter(global_company != "Bradespar") %>% 
  arrange(-net_profit_margin_percent)
```

```{r}
companies_1 %>% 
  arrange(-market_value_bil)
```

## Billionaire data
```{r}
billionaires_country <- billionaires %>% 
  count(country) %>% 
  arrange(-n) %>% 
  head(10) %>% 
  ggplot(aes(x=reorder(country,n), y=n))+
  geom_col(color = "black", fill ="coral1")+
  coord_flip()+
  labs(title = "No. of Billionaires by Country",
       x = "Country",
       y = "Number of Billionaires")
```

```{r}
billionaires_country+
  theme_light()+
  theme(plot.title = element_text(size = 10, face = "bold"),
        axis.title = element_text(size=10),
        axis.text.x = element_text(size=9, hjust=1))
```
## Companies by country Pie Chart
```{r}
companies %>% 
  count(country) %>% 
  arrange(-n) %>% 
  head(10) %>% 
  ggplot(aes(x=country, y=n, fill=country))+
  geom_col()+
  coord_polar()
```
```{r}
prop <- c(590, 297, 196, 65, 64, 58, 55, 54, 54, 52)
pie(prop)
```

```{r}
myPalette <- brewer.pal(9, "BuPu")
pie(prop, labels = c("US", "China", "Japan", "S.Korea", "UK", "Canada", "India", "France", "Hong Kong", "Germany"), border = "black", col=myPalette)
```

